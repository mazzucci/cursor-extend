"""{{ tool_name }} - Shell command utilities

Generated by cursor-extend. This is a pure Python module - no MCP dependency.
Use it in Cursor, terminal, scripts, notebooks, or anywhere Python runs.

Usage:
    from {{ tool_name | replace('-', '_') }} import run_command, check_command_available
    
    # Call functions directly
    output = run_command("git status")
    status = check_command_available("docker")
"""

import subprocess
from typing import Optional


def run_command(
    command: str,
    cwd: Optional[str] = None,
    timeout: int = 30
) -> str:
    """Run a shell command and return its output
    
    Security: Only run trusted commands. Validate inputs carefully.
    Consider restricting allowed commands for production use.
    
    Args:
        command: Shell command to run (e.g., "git status", "ls -la")
        cwd: Working directory (optional, defaults to current directory)
        timeout: Command timeout in seconds (default: 30)
        
    Returns:
        Command output as string, or error message if command fails
        
    Example customizations:
        - Add command whitelist: only allow specific commands
        - Add input validation: check for dangerous patterns
        - Add logging: track what commands are executed
        - Parse output: transform command output into structured data
        
    Examples:
        >>> output = run_command("git status")
        >>> print(output)
        >>> 
        >>> result = run_command("npm test", cwd="/path/to/project")
    """
    try:
        result = subprocess.run(
            command,
            shell=True,
            cwd=cwd,
            capture_output=True,
            text=True,
            timeout=timeout,
            check=False  # Don't raise exception on non-zero exit
        )
        
        if result.returncode != 0:
            return f"Command failed (exit code {result.returncode}):\n{result.stderr}"
        
        return result.stdout
        
    except subprocess.TimeoutExpired:
        return f"Error: Command timed out after {timeout} seconds"
    except Exception as e:
        return f"Error executing command: {str(e)}"


def check_command_available(command: str) -> str:
    """Check if a command-line tool is available
    
    Args:
        command: Command name to check (e.g., "git", "docker", "gh")
        
    Returns:
        Status message indicating if command is available and its version
        
    Example:
        >>> status = check_command_available("docker")
        >>> print(status)
        "✓ docker is available: Docker version 24.0.0"
    """
    try:
        # Try to get version (works for most CLI tools)
        result = subprocess.run(
            f"{command} --version",
            shell=True,
            capture_output=True,
            text=True,
            timeout=5,
            check=False
        )
        
        if result.returncode == 0:
            version = result.stdout.strip().split('\n')[0]  # First line usually has version
            return f"✓ {command} is available: {version}"
        else:
            # Try with -v flag
            result = subprocess.run(
                f"{command} -v",
                shell=True,
                capture_output=True,
                text=True,
                timeout=5,
                check=False
            )
            if result.returncode == 0:
                version = result.stdout.strip().split('\n')[0]
                return f"✓ {command} is available: {version}"
            else:
                return f"✗ {command} is not available or not responding to version check"
                
    except subprocess.TimeoutExpired:
        return f"✗ {command} check timed out"
    except Exception as e:
        return f"✗ Error checking {command}: {str(e)}"

